智能旋钮项目 简介： 本项目基于国外开源smartknob修改而来，添加了json,和二进制传输的modbus通信协议层.可以更好的对接不同智能家居设备，还有bluHID键盘功能，可以输出上下左右，控制浏览网页，优化电机控制算法，使旋钮拥有更好输出手感，更强，更准确的反馈力度，并添加了多种电机控制模式，模拟如棘轮,自锁开关等效果

特征： 240x240圆形LCD（“GC9A01”），由摆陀上的39.5mm手表玻璃保护 BLDC万向节电机，带有空心轴，用于机械和电气连接LCD。 搭载 ESP32-PICO-V3-02 （Lilygo TMicro32 Plus 模组） 用于压力检测的PCB弯曲和应变片（通过电机提供触觉反馈） 8 个侧照式 RGB LED （SK6812-SIDE-A） 点亮旋钮周围的环 USB-C （2.0） 连接器，用于 5V 电源和串行数据/编程 （CH340） VEML7700 环境光传感器，用于自动背光和 LED 强度调节 用于安装的多功能背板 - 使用 4 个螺钉或 2 个 3M 中型命令条（带有用于在安装后访问拆卸卡舌的切口） 前盖卡入式，便于检修印刷电路板 现状：不建议用于一般用途（根据电机/电子设备的可用性，可能需要进行机械和电气修订

目录介绍: Firmware 固件代码 平台为platformIO，项目核心代码全部基于此 其中src为项目核心文件夹，serial为通信协议层文件 代码基本逻辑，一个电机任务，一个显示任务，一个接口任务。 接口任务初始化了显示功能，协议层功能，电机功控制功能。

doc 项目图片以及原件图片

未来计划：

考虑改用 ESP32-S3-MINI-1 模块（一旦 Arduino 核心支持完成），因为这将允许直接支持 USB HID（用于计算机的操纵杆/宏键盘类型输入）

配置wifi并工作（可能是MQTT？当前内存是全屏帧缓冲精灵的问题。PSRAM可能会解决这个问题（需要更新的ESP-IDF和未发布的Arduino内核，从简短的测试中，我在启用PSRAM的情况下获得了可怕的性能），或者下一项可能有助于减少内存： 迁移到 LVGL，以获得更好的显示渲染和轻松支持菜单等。不应该在内存中要求完整的 240x240x24b 帧缓冲，释放一些用于 wifi 等。 家庭助理集成或其他实际应用

屏幕印刷电路板

订购说明：每个机械设计必须为 1.2 毫米厚（不是“标准”1.6 毫米）。

屏幕PCB上没有足够的组件，我选择手工焊接它们而不是用焊膏回流 和模板，但如果您订购模板，请参阅上面的注释，了解选择“自定义尺寸”以使其更容易 处理并节省运费。还要确保仅选择底部;所有组件都在底部 屏幕一侧的印刷电路板。

自动生成的最新（未经测试且可能已损坏！⚠️:

图解的

交互式物料清单

印刷电路板数据包

格伯斯

常见问题 （FAQ）

它适用于 XYZ 吗？

还没有，不管你想到什么“XYZ”。到目前为止，我只为视频中显示的演示实现了足够的固件，因此您实际上还不能将其用于任何富有成效的事情。基本的止动配置 API 在那里，但没有太多其他内容。许多固件工作仍有待完成。如果您构建一个，我希望您帮助添加对“XYZ”的支持！

我可以购买套件或已经组装好的吗？

应该不会吧？或者至少，我没有任何立即计划自己出售它们。不是我不想让你开心，但硬件是一项艰苦的工作，我只是在空闲时间做这些东西。

它是开源的，有一个相当宽松的许可证，所以理论上任何人都可以开始提供套件/组件。如果有人确实走上了出售它们的路线，请注意需要署名（如果您心情愉快，我不会拒绝版税/提示/感谢🙂).

固件和软件 有关固件和软件（以及如何开始使用）的更多文档，请参阅专用的 SmartKnob 固件和软件指南

一般组件信息 磁性编码器 MT6701 （美格泰克） 优秀的传感器，价格合理 - 强烈推荐。使用SSI时噪声比TLV493D更低，响应更快（控制回路更稳定）。

许多 IO 选项 - SSI、I2C 和 ABZ - 应该提供良好的响应延迟 SSI 包括用于验证数据的 CRC 无掉电或低功耗选项 - 可能不适合电池供电设备 美国分销商（Mouser、Digi-Key）不提供 数据表

订购（LCSC）

TLV493D （英飞凌） 未在 SmartKnob 视图中使用，但通常是一种常见/流行的磁编码器。对于触觉反馈实现来说，这是一个平庸的选择。使用Adafruit的QWIIC分线板易于原型设计。

在我的测试中，它很嘈杂，需要过滤/平滑，这会降低响应速度，损害控制回路的稳定性。或者，滤波较少，噪声 很容易被PID电机扭矩控制器中的衍生组件“放大”，引起可听见（和触觉）嗡嗡声/嗡嗡声。

但更大的问题是，显然存在一个已知的硅问题，导致内部ADC有时完全锁定，需要完全复位和重新配置，这可能会导致数据延迟/间隙！请参阅部分 5.6 在用户手册中

In the Master Controlled Mode (MCM) or the Fast Mode (FM) the ADC conversion may hang up. A hang up can be detected by:

Frame Counter (FRM) counter stucks and does not increment anymore. 根据我测试 4 种不同的 Adafruit 分线板的经验，其中 2 个 （50%） 在使用后一两分钟内经常表现出这种锁定行为。可以检测和自动重置（项目中有代码可以这样做），但它很慢，如果传感器经常锁定，可能会导致不希望的跳跃/延迟。
数据表

AS5600 （AMS） 一个平庸的选择。便宜的分线板随时可用。

在我的测试中，它相当嘈杂（传闻比 TLV493d 更嘈杂），需要滤波/平滑，这会降低响应速度，损害控制环路稳定性。此外，它的磁场强度低于我测试的其他传感器，当与强钕直径磁铁（如径向磁铁 8）一起使用时，需要明显的气隙（10-8995 毫米）。

数据表

电机驱动器 TMC6300-LA 这是一个相对较新的IC，是一个完美的匹配！通常没有任何其他驱动器（带有集成FET）满足本项目中使用的低压和低电流电机的要求（DRV8316 可能工作，但尚未经过测试）。

突出：

2-11V直流电机电源输入 高达 1.2A 有效值 微型 （3x3mm QFN） 数据表

产品页面

电机 32mm转子，空心轴，直径磁铁

32mm转子 15mm总高度（包括磁铁），12.75mm高（不含磁铁），9mm转子高度 低/零齿槽效应 - 非常适合完全平滑的输入 5.9毫米空心轴 内置编码器直径磁铁 经过验证的选项 总的来说，这是最容易上手的电机。低齿槽效应和内置直径磁铁很棒！

可从SparkFun获得！

确认 这个项目的灵感很大程度上来自Jesse Schoch的视频“触觉纹理和虚拟支架”和 在SimpleFOC社区中进行相应的讨论。说真的，如果没有那个视频，这个项目就不会存在 - 谢谢杰西！

许可证 本项目根据Apache v2（软件，电子，文档）和知识共享署名4.0（硬件/机械）（请参阅许可证.txt和知识共享）进行许可。

Copyright 2022 Scott Bezek

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.